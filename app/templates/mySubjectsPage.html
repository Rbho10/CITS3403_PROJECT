{% extends "homebase.html" %}

{% block title %}Subjects | ProTrack{% endblock %}

{% block head %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}

{% block body %}

<!--Main Content-->
<div class="main-content">
    <!--Top Navigation-->
    <div class="search-bar">
        <input type="text" id="search-input" placeholder="Search subject..." oninput="searchSubject()">
        <a href="{{ url_for('createSubject') }}" class="create-subject-btn">Create Subject</a>
    </div>

    <div class="subjects-list" id="subjects-list">
        <!--insert dynamic subjects list here-->
    </div>
</div>

<!--AJAX Script-->
<script>
    function searchSubject() {
        const query = document.getElementById('search-input').value;
        fetch('/search_subjects?query=' + encodeURIComponent(query))
            .then(response => response.json())
            .then(data => {
                const subjectsList = document.getElementById('subjects-list');
                subjectsList.innerHTML = ''; // Clear old list

                data.studysubject.forEach(subject => {
                    const card = `
                    <div class="subject-card">
                        <div class="subject-info">
                            <div class="subject-details">
                                <div class="subject-name">${subject.subject_name}</div>
                            </div>
                        </div>
                        <button class="go-btn" onclick="location.href='/subject/${subject.id}'">Go To</button>
                    </div>
            `;
                    subjectsList.innerHTML += card;
                });

                if (data.studysubject.length === 0) {
                    subjectsList.innerHTML = '<div>No subjects found!</div>';
                }
            })
            .catch(error => console.error('Error:', error));
    }
    document.addEventListener('DOMContentLoaded', searchSubject);
</script>


{%endblock%}